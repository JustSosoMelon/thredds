<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Upgrading To TDS 4.4</title>
  <link rel="stylesheet" href="tds.css" type="text/css">
</head>
<body>
<h1><img alt="Unidata" src="images/unidataLogo.png" align="middle" height="75" width="75"> Upgrading To TDS 4.4 (Beta)</h1>

<hr>
<h3>New Requirements</h3>
<ul>
  <li>Tomcat 7 (servlet 3.0) is now required</li>
  <li>On the command line when starting up Tomcat, you must specify <strong>-Dtds.content.root.path=&lt;content root&gt;</strong> where &lt;content root&gt; points to the top of the content directory (note its ../content, not ../content/thredds). For example:
        <blockquote>
          <pre>-Dtds.content.root.path=/opt/tomcat-home/content/</pre>
          <p>For example, your <strong>{tomcat}/bin/setenv.sh</strong> might look like:</p>
          <pre>
#!/bin/sh
#
ulimit -n 2048
#
CATALINA_HOME=&quot;/opt/tomcat-home&quot;
export CATALINA_HOME
CATALINA_BASE=&quot;/opt/tomcat-home&quot;
export CATALINA_BASE
JAVA_HOME=&quot;/opt/jdk&quot;
export JAVA_HOME
#
<strong>CONTENT_ROOT=-Dtds.content.root.path=/data/thredds/tds-dev/content</strong>
NORMAL=&quot;-d64 -Xmx4090m -Xms512m -server&quot;
MAX_PERM_GEN=&quot;-XX:MaxPermSize=256m&quot;
HEADLESS=&quot;-Djava.awt.headless=true&quot;
JAVA_PREFS_SYSTEM_ROOT=&quot;-Djava.util.prefs.systemRoot=$CATALINA_HOME/content/thredds/javaUtilPrefs -Djava.util.prefs.userRoot=$CATALINA_HOME/content/thredds/javaUtilPrefs&quot;
#             
JAVA_OPTS=&quot;$CONTENT_ROOT $NORMAL $MAX_PERM_GEN $HEADLESS $JAVA_PREFS_SYSTEM_ROOT&quot;            
export JAVA_OPTS
</pre>
</blockquote>
</li>
  <p><strong>Troubleshooting</strong>: </p>
  <p>If the content root is not correctly set, you will see a message like: &quot;<strong>SEVERE: Error listenerStart</strong>&quot; in <strong>{tomcat}/logs/catalina.out</strong> and &quot;<strong>Error creating bean with name 'tdsContext'</strong>&quot; in  <strong>{tomcat}/logs/localhost.log.</strong></p>
  <p>By default, the content root is set to <strong>&quot;../content&quot;</strong> relative to where tomcat is started. Since this directory varies and is not standard across servlet containers, you should always explicitly set <strong>-Dtds.content.root.path</strong>.</p>
  <p>Note  your catalogs are  under <strong>{tomcat}</strong><strong>/content/thredds</strong> but  <strong>tds.content.root.path</strong> does not include the <strong>thredds</strong> subdirectory.</p>
</ul>
<h3>&nbsp;</h3>
<h3>Netcdf Subset Service Changes</h3>
<blockquote>
  <p>The Netcdf Subset Service (ncss) has a different URL path, and the REST interface has changed.  If you have been using ncss from a script, you will need to check your URLs and parameters <a href="http://www.unidata.ucar.edu/software/thredds/v4.4/tds/reference/NetcdfSubsetServiceReference.html">(documentation</a>). If you are accessing the ncss from the HTML form, or are correctly parsing the catalog, nohting needs to be changed.<br>
</p>
  <p>An old (4.3) ncss URL:</p>
<pre> http://thredds.ucar.edu/thredds/ncss/grid/grib/NCEP/GFS/Global_0p5deg/best/dataset.html</pre>
  <p> Should  be changed in version 4.4 to:</p>
<pre> http://thredds.ucar.edu/thredds/ncss/grib/NCEP/GFS/Global_0p5deg/best/dataset.html</pre>
  <p> Note the only difference is the removal of &quot;/grid&quot;</p>
</blockquote>
<h3>New Features</h3>
<ul>
  <li>TDS
    <ul>
      <li>Point Feature Collections (point, stations) now handled by Netcdf Subset Service.</li>
      <li>Automatic Metadata Extraction from the dataset into the thredds catalogs, on point collections only but will extend to other collections. </li>
    </ul>
  </li>
  <li>NcML
    <ul>
      <li> updated to implement full extended model.</li>
      <li> logicalReduce allows you to remove length 1 dimensions [<a href="https://bugtracking.unidata.ucar.edu/browse/TDS-267">TDS-267</a>].</li>
      <li>NcML handles multichar separators.<br>
      </li>
    </ul>
  </li>
  <li>IOSPs
    <ul>
      <li>GRIB1:  indexing minimum version is 11, so  grib1 ncx files will be recreated. This fixes a problem where the vertical coordinates were not sorted correctly.</li>
      <li>Improved HDF-EOS processing.</li>
      <li>CF 1.6 DSG: bug in handling station profiles, multidimensional representation [<a href="ftp://ftp.unidata.ucar.edu/pub/thredds/4.4/current/thredds.war">TDS-513</a>]</li>
      <li>MSGnavigation scan mode bug</li>
    </ul>
  </li>
  <li>ToolsUI 
    <ul>
      <li>using new Swing Look and Feel</li>
      <li>table columns can be set by user (upper right button on header line)</li>
      <li>File Chooser improvements</li>
    </ul>
  </li>
</ul>
Other Changes
<ul>
  <li>Automatic generation of test catalogs on clean install no longer supported. You must create a catalog and threddsConfig.xml and place in <strong>content/thredds</strong> directory.</li>
</ul>
<h3>Internal changes</h3>
<ul>
  <li><strong>HttpClient</strong> library upgraded to 4.2, previously was 3.</li>
  <li>We are now using <strong>log4j2</strong>. The configuration file is in <strong>{tomcat}/webapps/thredds//WEB-INF/classes/log4j2.xml</strong>. See <a href="http://logging.apache.org/log4j/2.x/">http://logging.apache.org/log4j/2.x/</a></li>
  <li> Most services have been converted to <a href="http://docs.spring.io/spring/docs/3.0.x/reference/mvc.html">annotated Spring controllers</a>. Documentation on adding your own service is coming soon.</li>
  <li>    Unit testing framework now complete; 2000+ unit tests.</li>
</ul>
<p>&nbsp;</p>
<hr>

<address>
  <img src="thread.png" alt="TDS" height="108" width="110">This document is maintained by Unidata and was
  last updated Jan 2014. Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS
  support</a>.
</address>

</body>
</html>
